# 日志记录器

日志记录器是一种诊断工具，允许开发人员随着时间输出正在运行的程序的数据，然后对其进行归档。这允许对程序（在本例中是您的游戏）的运行方式进行后期描述。日志记录器通常支持一种标记类型，其中具有特定属性的事件会被标记和单独监视。然后，标记的事件要么输出到单独的文件中，要么设置为使用某种查看客户端来解析数据。这种分类的运行时信息可以详细揭示游戏的表现。

## 日志记录器的使用

举例来说，可以设计一个日志记录器来监视玩测试过程中的非关键错误。这些错误可以被标记为不同的严重性或其他游戏状态信息。通过在游戏后检查记录的输出，开发人员可以获得关于整个会话中错误数量和分布的重要信息。这提供了与更典型的诊断方法不同的视角，后者是观察单个错误然后立即修复它。下面展示了数据日志记录的另一个例子。

！[APM在重新播放中可视化显示](./resources/054_Loggers1.png)
*APM在重新播放中可视化显示，使用Scelight*

这张图表是星际争霸玩家在多人比赛中的每分钟动作次数（APM）的可视化。 APM每隔几秒记录一次，然后绘制出一张数据在游戏会话中的平滑图像。数据来自《星际争霸》的重播。重播本身是一个记录比赛中每个玩家动作的日志记录器的输出。

看起来可能有点牵强把这视为与正在讨论的文章相关。毕竟，重播旨在重建游戏过程中已经完成的比赛，而日志记录器通常监视程序的运行情况。尽管如此，尽管它看起来有些繁琐，但这对于星际争霸用户应该是一个熟悉的例子。毕竟，重播是为游戏的任何在线测试记录的，并且可以提供对测试期间发生的情况的有用画面。重播分析器，例如这种情况下的Scelight，提供了解析标记输出数据的客户端的例子。

## 在编辑器中创建一个日志记录器

在星际争霸引擎中直接组装一个日志记录器是可能的，也可能对您的项目开发有用。要做到这一点，需要满足一些规范。首先，必须有一种方法在代码的任何位置输出调试信息。然后需要能够将这些信息传递到编辑器之外并存储到文件结构中，根据日志记录标签将其分开到多个文件中。还建议有全局控制用于快速启用和停用日志记录。有了这个设计思路，您可以从编辑器中现有的功能中塑造出一个日志记录器。在输出选项方面，“调试”操作是个不错的起点。下面列出了这些操作的列表。

[！[调试操作](./resources/054_Loggers2.png)](./resources/054_Loggers2.png)
*调试操作*

这里的第一个关键点是“调试消息”操作。这允许将文本打印到文件、游戏窗口或触发器调试器中。选择此操作并进入触发器编辑器。在那里，您会注意到其参数非常适合于日志记录器设计。您可以在下面的图像中看到这些参数。

[！[调试消息参数](./resources/054_Loggers3.png)](./resources/054_Loggers3.png)
*调试消息参数*

初始参数设置输出文本，而第二个参数允许您指定调试消息类型。这是一个带有16个潜在值的预设，从“类型01”到“类型16”，可以作为输出的标记。一旦标记，您可以配置每个输出类型以打印到不同的文件，并在输出和展示这些输出的方式方面展示不同的行为。对于此演示，您将使用三个标记，每个标记均被建模为不同的错误严重级别。为了跟踪这些标记，它们每个都被设置为一个常量变量。具体映射如下所示。

logger_info = Type 01 \<Debug Message Type(Constant)\>

logger_warning = Type 02 \<Debug Message Type(Constant)\>

logger_error = Type 03 \<Debug Message Type(Constant)\>

设置完这些后，可以使用以下计划开发日志记录器触发器。

[！[调试触发器](./resources/054_Loggers4.png)](./resources/054_Loggers4.png)
*调试触发器*

通过使用“设置调试消息名称”操作，您可以为指定的每个调试消息类型分配一个自定义名称。该名称将出现在触发器调试器中可用的“显示用户输入”选项中，这样更容易处理不同的输出通道。这由“设置调试消息颜色”操作支持，它将使您更容易在触发器窗口中查看时进行区分。您可以在下面的图像中看到这一点。

[！[调试触发器](./resources/054_Loggers5.png)](./resources/054_Loggers5.png)
*调试触发器*

然后，最重要的是，“设置调试消息文件”允许为每个调试消息类型分配文件名。建议为每个记录级别分配一个唯一文件。这样可以使得此触发器作为一个完整的记录器，可以将错误类型分割为不同的文件以供测试后检查。对于单人游戏，在Windows上用于日志记录器文件的输出文件夹将是 C:\\Users\\\<username\>\\Documents\\StarCraft II\\UserLogs\\\<mapname\>。

[！[日志记录器输出文件](./resources/054_Loggers6.png)](./resources/054_Loggers6.png)
*日志记录器输出文件*

## 添加过滤器

到目前为止，日志记录器已经可以操作，并可以将潜在有用的诊断数据输出到单独的文件中。它满足了设计标准。然而，您可能希望进一步将调试消息进行一级别的过滤。这里有一些其他函数可以帮助。启用/禁用调试消息类型允许您在触发器调试器中切换每个特定的调试消息类型。但此过滤仅用于查看，对游戏中的输出或输出文件没有影响。如果您希望对游戏中的输出或输出文件进行过滤，则可以使用“过滤调试消息类型”操作。

不幸的是，在触发器调试器中没有办法仅禁用消息。一个变通方法是使用“调试消息”操作的第三个参数来禁用这些输出。如果您正在实现自己的日志记录器，将“调试消息”封装在一个动作定义中是一个好主意，以便自己永久构建此功能。

最后，当您为公众创建项目的发布版本时，这些调试过滤器可用于快速禁用所有调试输出，从而最大限度地提高您发布版本的性能。